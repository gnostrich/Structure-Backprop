# ============================================================================
# Auto-Reply to Moltbook - Autonomous AI-Powered Reply Workflow
# ============================================================================
# This workflow attempts to automatically fetch new replies from Moltbook and 
# responds to them using AI-generated content.
#
# âš ï¸ IMPORTANT NOTE:
# The Moltbook API currently does not expose an endpoint to fetch unread replies.
# This workflow will attempt to check multiple possible endpoints but may not
# find any new replies. For manual replies, use the "Reply to Moltbook Post" 
# workflow instead.
#
# FEATURES:
# - Attempts to fetch new replies from Moltbook (if API supports it)
# - Uses AI to generate contextual responses (if OPENAI_API_KEY is set)
# - Dynamically learns about your repository to provide relevant answers
# - Automatically posts replies back to Moltbook
#
# USAGE:
# - Trigger manually from Actions tab to check for new replies
# - Use dry-run mode to preview responses without posting
# - For guaranteed replies, use the "Reply to Moltbook Post" workflow instead
# ============================================================================

name: Auto-Reply to Moltbook

on:
  workflow_dispatch:  # Manual trigger only
    inputs:
      dry_run:
        description: 'Dry run mode (fetch but do not post replies)'
        required: false
        type: boolean
        default: false

jobs:
  auto-reply:
    runs-on: ubuntu-latest
    permissions:
      contents: read  # Only need read access to checkout the repository
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
    
    - name: Install dependencies
      run: |
        pip install requests
        # Optional: Install openai if OPENAI_API_KEY is configured
        if [ -n "${{ secrets.OPENAI_API_KEY }}" ]; then
          pip install openai || echo "âš ï¸ OpenAI package not installed, using templates"
        fi
    
    - name: Fetch and Reply to Moltbook Messages
      env:
        MOLTHUB_API_KEY: ${{ secrets.MOLTHUB_API_KEY }}
        OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        GITHUB_REPOSITORY: ${{ github.repository }}
        DRY_RUN: ${{ inputs.dry_run || 'false' }}
      run: |
        python3 .github/scripts/auto_reply_moltbook.py
    
    - name: Summary
      if: always()
      run: |
        echo "## ðŸ¤– Auto-Reply Workflow Complete" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "The autonomous reply system has processed Moltbook messages." >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### Status" >> $GITHUB_STEP_SUMMARY
        if [ "${{ job.status }}" == "success" ]; then
          echo "âœ… All replies processed successfully" >> $GITHUB_STEP_SUMMARY
        else
          echo "âš ï¸ Some issues occurred - check logs for details" >> $GITHUB_STEP_SUMMARY
        fi
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### Next Steps" >> $GITHUB_STEP_SUMMARY
        echo "- Run this workflow again anytime to check for new replies" >> $GITHUB_STEP_SUMMARY

