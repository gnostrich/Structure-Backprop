# ============================================================================
# Reply to MolHub Post
# ============================================================================
# This workflow posts a reply to an existing MolHub post.
# It can be triggered manually with the post ID and reply content.
#
# To trigger manually:
# 1. Go to Actions tab: https://github.com/gnostrich/Structure-Backprop/actions
# 2. Select "Reply to MolHub Post" workflow
# 3. Click "Run workflow"
# 4. Enter the post ID and your reply content
# ============================================================================

name: Reply to MolHub Post

on:
  workflow_dispatch:  # Manual trigger with inputs
    inputs:
      post_id:
        description: 'The ID of the MolHub post to reply to'
        required: true
        type: string
      reply_content:
        description: 'The content of your reply'
        required: true
        type: string

jobs:
  reply-to-molthub:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
    
    - name: Reply to MolHub Post
      env:
        MOLTHUB_API_KEY: ${{ secrets.MOLTHUB_API_KEY }}
        POST_ID: ${{ github.event.inputs.post_id }}
        REPLY_CONTENT: ${{ github.event.inputs.reply_content }}
      run: |
        echo "ðŸš€ Posting reply to MolHub post #$POST_ID..."
        echo ""
        
        # Make the API call to post a reply
        HTTP_CODE=$(curl -s -w "%{http_code}" -o /tmp/response.json \
          -X POST \
          -H "Authorization: Bearer $MOLTHUB_API_KEY" \
          -H "Content-Type: application/json" \
          -d "{
                \"post_id\": \"$POST_ID\",
                \"content\": $(echo "$REPLY_CONTENT" | jq -Rs .)
              }" \
          https://www.moltbook.com/api/v1/posts/$POST_ID/replies)
        
        echo ""
        echo "Response code: $HTTP_CODE"
        
        if [ "$HTTP_CODE" -eq 200 ] || [ "$HTTP_CODE" -eq 201 ] || [ "$HTTP_CODE" -eq 204 ]; then
          echo ""
          echo "âœ… SUCCESS! Reply posted to MolHub post #$POST_ID!"
          echo ""
          echo "ðŸ“‹ Reply Details:"
          echo "   Post ID: $POST_ID"
          echo "   Content: ${REPLY_CONTENT:0:100}..."
          echo ""
          echo "ðŸŽ‰ Next Steps:"
          echo "   1. Check MolHub to see your reply: https://www.moltbook.com/"
          echo "   2. Monitor for further responses"
          echo "   3. Continue the conversation as needed"
          echo ""
          cat /tmp/response.json 2>/dev/null || true
        else
          echo ""
          echo "âŒ Failed to post reply to MolHub"
          echo "   HTTP Status: $HTTP_CODE"
          echo ""
          echo "Response:"
          cat /tmp/response.json 2>/dev/null || echo "No response body"
          exit 1
        fi
    
    - name: Summary
      if: success()
      run: |
        echo "## ðŸŽ‰ MolHub Reply Successful!" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "Your reply has been posted to the MolHub conversation!" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### What was posted:" >> $GITHUB_STEP_SUMMARY
        echo "- **Post ID:** ${{ github.event.inputs.post_id }}" >> $GITHUB_STEP_SUMMARY
        echo "- **Platform:** MolHub" >> $GITHUB_STEP_SUMMARY
        echo "- **Content:** Reply posted successfully" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### Next steps:" >> $GITHUB_STEP_SUMMARY
        echo "1. Visit [MolHub](https://www.moltbook.com/) to see your reply" >> $GITHUB_STEP_SUMMARY
        echo "2. Monitor the conversation for further responses" >> $GITHUB_STEP_SUMMARY
        echo "3. Continue engaging with the community" >> $GITHUB_STEP_SUMMARY
